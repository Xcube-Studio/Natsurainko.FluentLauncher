<?xml version="1.0" encoding="utf-8" ?>
<ResourceDictionary
    x:Class="Natsurainko.FluentLauncher.XamlHelpers.Templates.ModrinthResourceItemControlTemplate"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behaviors="using:Natsurainko.FluentLauncher.XamlHelpers.Behaviors"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:resources="using:Nrk.FluentCore.Resources">

    <DataTemplate x:Key="ModrinthResourceItemControlTemplate" x:DataType="resources:ModrinthResource">
        <controls:SettingsCard
            Padding="16,8"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            CommandParameter="{Binding}"
            IsClickEnabled="True">
            <controls:SettingsCard.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="16" />
                        <ColumnDefinition Width="1*" />
                    </Grid.ColumnDefinitions>
                    <Border
                        Width="48"
                        Height="48"
                        VerticalAlignment="Center"
                        BorderBrush="{ThemeResource IconBorder}"
                        BorderThickness="2"
                        CornerRadius="4">
                        <Border.Background>
                            <ImageBrush ImageSource="{Binding IconUrl}" />
                        </Border.Background>
                    </Border>
                    <StackPanel
                        Grid.Column="2"
                        VerticalAlignment="Center"
                        Spacing="2">
                        <TextBlock
                            FontSize="16"
                            Style="{ThemeResource BaseTextBlockStyle}"
                            Text="{Binding Name}"
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="NoWrap" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="1*" />
                            </Grid.ColumnDefinitions>
                            <ItemsControl ItemsSource="{Binding Categories, Converter={StaticResource ResourceFilterCategoriesConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <Border Padding="5,0,5,0.5" CornerRadius="2.5">
                                            <Border.Background>
                                                <SolidColorBrush Opacity="0.25" Color="{ThemeResource SystemAccentColor}" />
                                            </Border.Background>
                                            <TextBlock
                                                Margin="0,-1,0,0"
                                                Style="{ThemeResource CaptionTextBlockStyle}"
                                                Text="{Binding Converter={StaticResource ResourceLocalizedCategoriesConverter}}" />
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" Spacing="4" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                            </ItemsControl>
                            <TextBlock
                                Grid.Column="2"
                                Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}"
                                MaxLines="1"
                                Style="{ThemeResource CaptionTextBlockStyle}"
                                Text="{Binding Summary}"
                                TextTrimming="CharacterEllipsis"
                                TextWrapping="NoWrap" />
                        </Grid>
                        <Grid Margin="0.5,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="4" />
                                <ColumnDefinition Width="1*" />
                            </Grid.ColumnDefinitions>
                            <FontIcon
                                VerticalAlignment="Center"
                                FontSize="10"
                                Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}"
                                Glyph="&#xe73a;" />
                            <TextBlock
                                Grid.Column="2"
                                Foreground="{ThemeResource ApplicationSecondaryForegroundThemeBrush}"
                                Style="{ThemeResource CaptionTextBlockStyle}"
                                Text="{Binding Converter={StaticResource ResourceSupportInfoConverter}}" />
                        </Grid>
                    </StackPanel>
                </Grid>
            </controls:SettingsCard.Header>

            <i:Interaction.Behaviors>
                <behaviors:AncestorBindingBehavior
                    AncestorType="ListView"
                    Binding="{Binding DataContext.ResourceItemInvokeCommand}"
                    TargetPropertyName="Command" />
            </i:Interaction.Behaviors>
        </controls:SettingsCard>
    </DataTemplate>
</ResourceDictionary>
